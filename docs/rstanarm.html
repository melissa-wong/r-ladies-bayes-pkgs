<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 rstanarm | Intro to R Bayes Packages</title>
  <meta name="description" content="This is an introduction to several R packages for Bayesian analysis." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 rstanarm | Intro to R Bayes Packages" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is an introduction to several R packages for Bayesian analysis." />
  <meta name="github-repo" content="melissa-wong/r-ladies-rtp-bayes-pkgs" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 rstanarm | Intro to R Bayes Packages" />
  
  <meta name="twitter:description" content="This is an introduction to several R packages for Bayesian analysis." />
  

<meta name="author" content="Melissa Wong" />


<meta name="date" content="2020-12-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="rethinking.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Intro to R Bayes Packages</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#resources"><i class="fa fa-check"></i><b>2.1</b> Resources</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#a-motivating-example"><i class="fa fa-check"></i><b>2.2</b> A Motivating Example</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#workflow"><i class="fa fa-check"></i><b>2.3</b> Workflow</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#data"><i class="fa fa-check"></i><b>2.4</b> Data</a></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#prior-information"><i class="fa fa-check"></i><b>2.5</b> Prior Information</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="rstanarm.html"><a href="rstanarm.html"><i class="fa fa-check"></i><b>3</b> rstanarm</a><ul>
<li class="chapter" data-level="3.1" data-path="rstanarm.html"><a href="rstanarm.html#resources-1"><i class="fa fa-check"></i><b>3.1</b> Resources</a></li>
<li class="chapter" data-level="3.2" data-path="rstanarm.html"><a href="rstanarm.html#description"><i class="fa fa-check"></i><b>3.2</b> Description</a></li>
<li class="chapter" data-level="3.3" data-path="rstanarm.html"><a href="rstanarm.html#environment-setup"><i class="fa fa-check"></i><b>3.3</b> Environment Setup</a></li>
<li class="chapter" data-level="3.4" data-path="rstanarm.html"><a href="rstanarm.html#linear-model-default-priors"><i class="fa fa-check"></i><b>3.4</b> Linear Model (Default Priors)</a><ul>
<li class="chapter" data-level="3.4.1" data-path="rstanarm.html"><a href="rstanarm.html#define-model"><i class="fa fa-check"></i><b>3.4.1</b> Define Model</a></li>
<li class="chapter" data-level="3.4.2" data-path="rstanarm.html"><a href="rstanarm.html#prior-predictive-distribution"><i class="fa fa-check"></i><b>3.4.2</b> Prior Predictive Distribution</a></li>
<li class="chapter" data-level="3.4.3" data-path="rstanarm.html"><a href="rstanarm.html#diagnostics"><i class="fa fa-check"></i><b>3.4.3</b> Diagnostics</a></li>
<li class="chapter" data-level="3.4.4" data-path="rstanarm.html"><a href="rstanarm.html#posterior-distribution"><i class="fa fa-check"></i><b>3.4.4</b> Posterior Distribution</a></li>
<li class="chapter" data-level="3.4.5" data-path="rstanarm.html"><a href="rstanarm.html#posterior-predictive-distribution"><i class="fa fa-check"></i><b>3.4.5</b> Posterior Predictive Distribution</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="rstanarm.html"><a href="rstanarm.html#linear-model-user-defined-priors"><i class="fa fa-check"></i><b>3.5</b> Linear Model (User-Defined Priors)</a><ul>
<li class="chapter" data-level="3.5.1" data-path="rstanarm.html"><a href="rstanarm.html#define-model-1"><i class="fa fa-check"></i><b>3.5.1</b> Define Model</a></li>
<li class="chapter" data-level="3.5.2" data-path="rstanarm.html"><a href="rstanarm.html#prior-predictive-distribution-1"><i class="fa fa-check"></i><b>3.5.2</b> Prior Predictive Distribution</a></li>
<li class="chapter" data-level="3.5.3" data-path="rstanarm.html"><a href="rstanarm.html#diagnostics-1"><i class="fa fa-check"></i><b>3.5.3</b> Diagnostics</a></li>
<li class="chapter" data-level="3.5.4" data-path="rstanarm.html"><a href="rstanarm.html#posterior-distribution-1"><i class="fa fa-check"></i><b>3.5.4</b> Posterior Distribution</a></li>
<li class="chapter" data-level="3.5.5" data-path="rstanarm.html"><a href="rstanarm.html#posterior-predictive-distribution-1"><i class="fa fa-check"></i><b>3.5.5</b> Posterior Predictive Distribution</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="rstanarm.html"><a href="rstanarm.html#semi-parametric-model"><i class="fa fa-check"></i><b>3.6</b> Semi-parametric Model</a><ul>
<li class="chapter" data-level="3.6.1" data-path="rstanarm.html"><a href="rstanarm.html#define-model-2"><i class="fa fa-check"></i><b>3.6.1</b> Define model</a></li>
<li class="chapter" data-level="3.6.2" data-path="rstanarm.html"><a href="rstanarm.html#prior-predictive-distribution-2"><i class="fa fa-check"></i><b>3.6.2</b> Prior Predictive Distribution</a></li>
<li class="chapter" data-level="3.6.3" data-path="rstanarm.html"><a href="rstanarm.html#diagnostics-and-posterior"><i class="fa fa-check"></i><b>3.6.3</b> Diagnostics and Posterior</a></li>
<li class="chapter" data-level="3.6.4" data-path="rstanarm.html"><a href="rstanarm.html#posterior-predictive-distribution-2"><i class="fa fa-check"></i><b>3.6.4</b> Posterior Predictive Distribution</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="rstanarm.html"><a href="rstanarm.html#session-info"><i class="fa fa-check"></i><b>3.7</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rethinking.html"><a href="rethinking.html"><i class="fa fa-check"></i><b>4</b> rethinking</a><ul>
<li class="chapter" data-level="4.1" data-path="rethinking.html"><a href="rethinking.html#resources-2"><i class="fa fa-check"></i><b>4.1</b> Resources</a></li>
<li class="chapter" data-level="4.2" data-path="rethinking.html"><a href="rethinking.html#description-1"><i class="fa fa-check"></i><b>4.2</b> Description</a></li>
<li class="chapter" data-level="4.3" data-path="rethinking.html"><a href="rethinking.html#environment-setup-1"><i class="fa fa-check"></i><b>4.3</b> Environment Setup</a></li>
<li class="chapter" data-level="4.4" data-path="rethinking.html"><a href="rethinking.html#linear-model"><i class="fa fa-check"></i><b>4.4</b> Linear Model</a><ul>
<li class="chapter" data-level="4.4.1" data-path="rethinking.html"><a href="rethinking.html#define-model-3"><i class="fa fa-check"></i><b>4.4.1</b> Define Model</a></li>
<li class="chapter" data-level="4.4.2" data-path="rethinking.html"><a href="rethinking.html#rethinkingprior"><i class="fa fa-check"></i><b>4.4.2</b> Prior Predictive Distribution</a></li>
<li class="chapter" data-level="4.4.3" data-path="rethinking.html"><a href="rethinking.html#diagnostics-2"><i class="fa fa-check"></i><b>4.4.3</b> Diagnostics</a></li>
<li class="chapter" data-level="4.4.4" data-path="rethinking.html"><a href="rethinking.html#posterior-distribution-2"><i class="fa fa-check"></i><b>4.4.4</b> Posterior Distribution</a></li>
<li class="chapter" data-level="4.4.5" data-path="rethinking.html"><a href="rethinking.html#posterior-predictive-distribution-3"><i class="fa fa-check"></i><b>4.4.5</b> Posterior Predictive Distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="rethinking.html"><a href="rethinking.html#GAM"><i class="fa fa-check"></i><b>4.5</b> Semi-parametric Model</a><ul>
<li class="chapter" data-level="4.5.1" data-path="rethinking.html"><a href="rethinking.html#define-model-4"><i class="fa fa-check"></i><b>4.5.1</b> Define Model</a></li>
<li class="chapter" data-level="4.5.2" data-path="rethinking.html"><a href="rethinking.html#prior-predictive-distribution-3"><i class="fa fa-check"></i><b>4.5.2</b> Prior Predictive Distribution</a></li>
<li class="chapter" data-level="4.5.3" data-path="rethinking.html"><a href="rethinking.html#diagnostics-3"><i class="fa fa-check"></i><b>4.5.3</b> Diagnostics</a></li>
<li class="chapter" data-level="4.5.4" data-path="rethinking.html"><a href="rethinking.html#posterior-distribution-3"><i class="fa fa-check"></i><b>4.5.4</b> Posterior Distribution</a></li>
<li class="chapter" data-level="4.5.5" data-path="rethinking.html"><a href="rethinking.html#posterior-predictive-distribution-4"><i class="fa fa-check"></i><b>4.5.5</b> Posterior Predictive Distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="rethinking.html"><a href="rethinking.html#extras"><i class="fa fa-check"></i><b>4.6</b> Extras</a></li>
<li class="chapter" data-level="4.7" data-path="rethinking.html"><a href="rethinking.html#session-info-1"><i class="fa fa-check"></i><b>4.7</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="brms.html"><a href="brms.html"><i class="fa fa-check"></i><b>5</b> brms</a><ul>
<li class="chapter" data-level="5.1" data-path="brms.html"><a href="brms.html#resources-3"><i class="fa fa-check"></i><b>5.1</b> Resources</a></li>
<li class="chapter" data-level="5.2" data-path="brms.html"><a href="brms.html#description-2"><i class="fa fa-check"></i><b>5.2</b> Description</a></li>
<li class="chapter" data-level="5.3" data-path="brms.html"><a href="brms.html#environment-setup-2"><i class="fa fa-check"></i><b>5.3</b> Environment Setup</a></li>
<li class="chapter" data-level="5.4" data-path="brms.html"><a href="brms.html#linear-model-1"><i class="fa fa-check"></i><b>5.4</b> Linear Model</a><ul>
<li class="chapter" data-level="5.4.1" data-path="brms.html"><a href="brms.html#define-model-5"><i class="fa fa-check"></i><b>5.4.1</b> Define Model</a></li>
<li class="chapter" data-level="5.4.2" data-path="brms.html"><a href="brms.html#prior-predictive-distribution-4"><i class="fa fa-check"></i><b>5.4.2</b> Prior Predictive Distribution</a></li>
<li class="chapter" data-level="5.4.3" data-path="brms.html"><a href="brms.html#diagnostics-4"><i class="fa fa-check"></i><b>5.4.3</b> Diagnostics</a></li>
<li class="chapter" data-level="5.4.4" data-path="brms.html"><a href="brms.html#posterior-distribution-4"><i class="fa fa-check"></i><b>5.4.4</b> Posterior Distribution</a></li>
<li class="chapter" data-level="5.4.5" data-path="brms.html"><a href="brms.html#posterior-predictive-distribution-5"><i class="fa fa-check"></i><b>5.4.5</b> Posterior Predictive Distribution</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="brms.html"><a href="brms.html#semi-parametric-model-1"><i class="fa fa-check"></i><b>5.5</b> Semi-parametric Model</a><ul>
<li class="chapter" data-level="5.5.1" data-path="brms.html"><a href="brms.html#define-model-6"><i class="fa fa-check"></i><b>5.5.1</b> Define Model</a></li>
<li class="chapter" data-level="5.5.2" data-path="brms.html"><a href="brms.html#prior-predictive-distribution-5"><i class="fa fa-check"></i><b>5.5.2</b> Prior Predictive Distribution</a></li>
<li class="chapter" data-level="5.5.3" data-path="brms.html"><a href="brms.html#diagnostics-5"><i class="fa fa-check"></i><b>5.5.3</b> Diagnostics</a></li>
<li class="chapter" data-level="5.5.4" data-path="brms.html"><a href="brms.html#posterior-distribution-5"><i class="fa fa-check"></i><b>5.5.4</b> Posterior Distribution</a></li>
<li class="chapter" data-level="5.5.5" data-path="brms.html"><a href="brms.html#posterior-predictive-distribution-6"><i class="fa fa-check"></i><b>5.5.5</b> Posterior Predictive Distribution</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="brms.html"><a href="brms.html#semi-parametric-model-random-walk-prior"><i class="fa fa-check"></i><b>5.6</b> Semi-parametric Model (Random Walk Prior)</a><ul>
<li class="chapter" data-level="5.6.1" data-path="brms.html"><a href="brms.html#define-model-7"><i class="fa fa-check"></i><b>5.6.1</b> Define Model</a></li>
<li class="chapter" data-level="5.6.2" data-path="brms.html"><a href="brms.html#prior-predictive-distribution-6"><i class="fa fa-check"></i><b>5.6.2</b> Prior Predictive Distribution</a></li>
<li class="chapter" data-level="5.6.3" data-path="brms.html"><a href="brms.html#diagnostics-6"><i class="fa fa-check"></i><b>5.6.3</b> Diagnostics</a></li>
<li class="chapter" data-level="5.6.4" data-path="brms.html"><a href="brms.html#posterior-distribution-6"><i class="fa fa-check"></i><b>5.6.4</b> Posterior Distribution</a></li>
<li class="chapter" data-level="5.6.5" data-path="brms.html"><a href="brms.html#posterior-predictive-distribution-7"><i class="fa fa-check"></i><b>5.6.5</b> Posterior Predictive Distribution</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="brms.html"><a href="brms.html#session-info-2"><i class="fa fa-check"></i><b>5.7</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rstan.html"><a href="rstan.html"><i class="fa fa-check"></i><b>6</b> rstan</a><ul>
<li class="chapter" data-level="6.1" data-path="rstan.html"><a href="rstan.html#resources-4"><i class="fa fa-check"></i><b>6.1</b> Resources</a></li>
<li class="chapter" data-level="6.2" data-path="rstan.html"><a href="rstan.html#description-3"><i class="fa fa-check"></i><b>6.2</b> Description</a></li>
<li class="chapter" data-level="6.3" data-path="rstan.html"><a href="rstan.html#environment-setup-3"><i class="fa fa-check"></i><b>6.3</b> Environment Setup</a></li>
<li class="chapter" data-level="6.4" data-path="rstan.html"><a href="rstan.html#linear-model-2"><i class="fa fa-check"></i><b>6.4</b> Linear Model</a><ul>
<li class="chapter" data-level="6.4.1" data-path="rstan.html"><a href="rstan.html#define-model-8"><i class="fa fa-check"></i><b>6.4.1</b> Define Model</a></li>
<li class="chapter" data-level="6.4.2" data-path="rstan.html"><a href="rstan.html#prior-predictive-distribution-7"><i class="fa fa-check"></i><b>6.4.2</b> Prior Predictive Distribution</a></li>
<li class="chapter" data-level="6.4.3" data-path="rstan.html"><a href="rstan.html#diagnostics-7"><i class="fa fa-check"></i><b>6.4.3</b> Diagnostics</a></li>
<li class="chapter" data-level="6.4.4" data-path="rstan.html"><a href="rstan.html#posterior-distribution-7"><i class="fa fa-check"></i><b>6.4.4</b> Posterior Distribution</a></li>
<li class="chapter" data-level="6.4.5" data-path="rstan.html"><a href="rstan.html#posterior-predictive-distribution-8"><i class="fa fa-check"></i><b>6.4.5</b> Posterior Predictive Distribution</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="rstan.html"><a href="rstan.html#semi-parametric-model-2"><i class="fa fa-check"></i><b>6.5</b> Semi-parametric Model</a><ul>
<li class="chapter" data-level="6.5.1" data-path="rstan.html"><a href="rstan.html#define-model-9"><i class="fa fa-check"></i><b>6.5.1</b> Define Model</a></li>
<li class="chapter" data-level="6.5.2" data-path="rstan.html"><a href="rstan.html#prior-predictive-distribution-8"><i class="fa fa-check"></i><b>6.5.2</b> Prior Predictive Distribution</a></li>
<li class="chapter" data-level="6.5.3" data-path="rstan.html"><a href="rstan.html#diagnostics-8"><i class="fa fa-check"></i><b>6.5.3</b> Diagnostics</a></li>
<li class="chapter" data-level="6.5.4" data-path="rstan.html"><a href="rstan.html#posterior-distribution-8"><i class="fa fa-check"></i><b>6.5.4</b> Posterior Distribution</a></li>
<li class="chapter" data-level="6.5.5" data-path="rstan.html"><a href="rstan.html#posterior-predictive-distribution-9"><i class="fa fa-check"></i><b>6.5.5</b> Posterior Predictive Distribution</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="rstan.html"><a href="rstan.html#semi-parametric-model-random-walk-prior-1"><i class="fa fa-check"></i><b>6.6</b> Semi-parametric Model (Random Walk Prior)</a><ul>
<li class="chapter" data-level="6.6.1" data-path="rstan.html"><a href="rstan.html#define-model-10"><i class="fa fa-check"></i><b>6.6.1</b> Define Model</a></li>
<li class="chapter" data-level="6.6.2" data-path="rstan.html"><a href="rstan.html#diagnostics-9"><i class="fa fa-check"></i><b>6.6.2</b> Diagnostics</a></li>
<li class="chapter" data-level="6.6.3" data-path="rstan.html"><a href="rstan.html#posterior-distribution-9"><i class="fa fa-check"></i><b>6.6.3</b> Posterior Distribution</a></li>
<li class="chapter" data-level="6.6.4" data-path="rstan.html"><a href="rstan.html#posterior-predictive-distribution-10"><i class="fa fa-check"></i><b>6.6.4</b> Posterior Predictive Distribution</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="rstan.html"><a href="rstan.html#session-info-3"><i class="fa fa-check"></i><b>6.7</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intro to R Bayes Packages</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rstanarm" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> rstanarm</h1>
<div id="resources-1" class="section level2">
<h2><span class="header-section-number">3.1</span> Resources</h2>
<ul>
<li><p><a href="https://avehtari.github.io/ROS-Examples/index.html">Regression and Other Stories</a> by Gelman, Hill and Vehtari</p></li>
<li><p><a href="https://mc-stan.org/users/interfaces/rstanarm">rstanarm online documentation</a></p></li>
</ul>
</div>
<div id="description" class="section level2">
<h2><span class="header-section-number">3.2</span> Description</h2>
<p>The <code>rstanarm</code> package is one of the easiest ways to get started with Bayesian models. The functions parallel the frequentist functions you’re probably already familiar with, and the syntax will also be familiar. You aren’t required to explicitly choose priors because all of the functions have weakly informative priors by default (although some might argue <em>not</em> being required to specify priors is a drawback). The primary limitation I’ve found thus far is the supported types for user-defined priors is somewhat limited.</p>
</div>
<div id="environment-setup" class="section level2">
<h2><span class="header-section-number">3.3</span> Environment Setup</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="rstanarm.html#cb1-1"></a><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())</span>
<span id="cb1-2"><a href="rstanarm.html#cb1-2"></a></span>
<span id="cb1-3"><a href="rstanarm.html#cb1-3"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-4"><a href="rstanarm.html#cb1-4"></a><span class="kw">options</span>(<span class="st">&quot;scipen&quot;</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;digits&quot;</span> =<span class="st"> </span><span class="dv">4</span>)</span>
<span id="cb1-5"><a href="rstanarm.html#cb1-5"></a></span>
<span id="cb1-6"><a href="rstanarm.html#cb1-6"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-7"><a href="rstanarm.html#cb1-7"></a><span class="kw">library</span>(gridExtra)</span>
<span id="cb1-8"><a href="rstanarm.html#cb1-8"></a><span class="kw">library</span>(kableExtra)</span>
<span id="cb1-9"><a href="rstanarm.html#cb1-9"></a><span class="kw">library</span>(datasets)</span>
<span id="cb1-10"><a href="rstanarm.html#cb1-10"></a><span class="kw">data</span>(mtcars)</span>
<span id="cb1-11"><a href="rstanarm.html#cb1-11"></a></span>
<span id="cb1-12"><a href="rstanarm.html#cb1-12"></a><span class="kw">library</span>(rstanarm)</span>
<span id="cb1-13"><a href="rstanarm.html#cb1-13"></a><span class="kw">library</span>(bayesplot)</span>
<span id="cb1-14"><a href="rstanarm.html#cb1-14"></a></span>
<span id="cb1-15"><a href="rstanarm.html#cb1-15"></a><span class="co"># Set number of cores</span></span>
<span id="cb1-16"><a href="rstanarm.html#cb1-16"></a><span class="kw">options</span>(<span class="dt">mc.cores =</span> parallel<span class="op">::</span><span class="kw">detectCores</span>()<span class="op">-</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="linear-model-default-priors" class="section level2">
<h2><span class="header-section-number">3.4</span> Linear Model (Default Priors)</h2>
<div id="define-model" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Define Model</h3>
<p>Let’s start with the following simple linear model:</p>
<p><span class="math display">\[\begin{align*}
  mpg &amp;\sim N(\mu, \sigma^2) \\
  \mu &amp;= a + b*disp \\
\end{align*}\]</span></p>
<p>The <code>stan_glm</code> function from the <code>rstanarm</code> package fits a Bayesian linear model. The syntax is very similar to <code>lm</code>/<code>glm</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="rstanarm.html#cb2-1"></a>mdl1 &lt;-<span class="st"> </span><span class="kw">stan_glm</span>(mpg <span class="op">~</span><span class="st"> </span>disp, <span class="dt">data =</span> mtcars)</span></code></pre></div>
</div>
<div id="prior-predictive-distribution" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Prior Predictive Distribution</h3>
<p>Next, I’ll examine the prior predictive distribution to see if the default priors seem reasonable. The <code>prior_summary</code> function shows the default priors for the model as well as the adjusted priors after automatic scaling. See <a href="http://mc-stan.org/rstanarm/articles/priors.html" class="uri">http://mc-stan.org/rstanarm/articles/priors.html</a> if you are interested in the details about how the default and adjusted priors are calculated.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="rstanarm.html#cb3-1"></a><span class="kw">prior_summary</span>(mdl1)</span></code></pre></div>
<pre><code>## Priors for model &#39;mdl1&#39; 
## ------
## Intercept (after predictors centered)
##   Specified prior:
##     ~ normal(location = 20, scale = 2.5)
##   Adjusted prior:
##     ~ normal(location = 20, scale = 15)
## 
## Coefficients
##   Specified prior:
##     ~ normal(location = 0, scale = 2.5)
##   Adjusted prior:
##     ~ normal(location = 0, scale = 0.12)
## 
## Auxiliary (sigma)
##   Specified prior:
##     ~ exponential(rate = 1)
##   Adjusted prior:
##     ~ exponential(rate = 0.17)
## ------
## See help(&#39;prior_summary.stanreg&#39;) for more details</code></pre>
<p>Overlaying the default prior for the intercept with the EPA data gives a sense of what a weakly informative prior means for this data.</p>
<p><img src="02_rstanarm_files/figure-html/epa-1.png" width="672" /></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="rstanarm.html#cb5-1"></a><span class="co"># Plot prior predictive distribution using adjusted priors</span></span>
<span id="cb5-2"><a href="rstanarm.html#cb5-2"></a>N &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb5-3"><a href="rstanarm.html#cb5-3"></a></span>
<span id="cb5-4"><a href="rstanarm.html#cb5-4"></a>prior_samples &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">a =</span> <span class="kw">rnorm</span>(N, <span class="dv">20</span>, <span class="dv">15</span>),</span>
<span id="cb5-5"><a href="rstanarm.html#cb5-5"></a>                            <span class="dt">b =</span> <span class="kw">rnorm</span>(N, <span class="dv">0</span>, <span class="fl">0.12</span>))</span>
<span id="cb5-6"><a href="rstanarm.html#cb5-6"></a></span>
<span id="cb5-7"><a href="rstanarm.html#cb5-7"></a>D &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(mtcars<span class="op">$</span>disp), <span class="kw">max</span>(mtcars<span class="op">$</span>disp), <span class="dt">length.out =</span> N)</span>
<span id="cb5-8"><a href="rstanarm.html#cb5-8"></a></span>
<span id="cb5-9"><a href="rstanarm.html#cb5-9"></a>res &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">apply</span>(prior_samples, <span class="dv">1</span>, </span>
<span id="cb5-10"><a href="rstanarm.html#cb5-10"></a>                           <span class="cf">function</span>(x) x[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>x[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>(D<span class="op">-</span><span class="kw">mean</span>(mtcars<span class="op">$</span>disp)))) <span class="op">%&gt;%</span></span>
<span id="cb5-11"><a href="rstanarm.html#cb5-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">disp =</span> D) <span class="op">%&gt;%</span></span>
<span id="cb5-12"><a href="rstanarm.html#cb5-12"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols=</span><span class="kw">c</span>(<span class="op">-</span><span class="st">&quot;disp&quot;</span>), <span class="dt">names_to=</span><span class="st">&quot;iter&quot;</span>) </span>
<span id="cb5-13"><a href="rstanarm.html#cb5-13"></a></span>
<span id="cb5-14"><a href="rstanarm.html#cb5-14"></a>res <span class="op">%&gt;%</span></span>
<span id="cb5-15"><a href="rstanarm.html#cb5-15"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb5-16"><a href="rstanarm.html#cb5-16"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>disp, <span class="dt">y=</span>value, <span class="dt">group=</span>iter), <span class="dt">alpha=</span><span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb5-17"><a href="rstanarm.html#cb5-17"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;disp&quot;</span>, <span class="dt">y=</span><span class="st">&quot;prior predictive mpg&quot;</span>)</span></code></pre></div>
<p><img src="02_rstanarm_files/figure-html/mdl1_prior_plot-1.png" width="672" /></p>
<p>I notice two things in the prior predictive distribution which seem unrealistic given what I know about the real world: 1) negative mpg and 2) increasing mpg as displacement increases. Later on I’ll choose a more informative prior which incorporates this external knowledge. But let’s proceed with the analysis and see what happens.</p>
</div>
<div id="diagnostics" class="section level3">
<h3><span class="header-section-number">3.4.3</span> Diagnostics</h3>
<p>I’ll walk through the steps for manually extracting the key diagnostic information from the <code>mdl1</code> object since I think that can be helpful to understand exactly what’s going on. However, once you have a handle on these steps I highly recommend the <code>shinystan</code> package; it will automatically create all of these diagnostic plots (and more) with an nice interactive web interface.</p>
<div id="trace-plots" class="section level4">
<h4><span class="header-section-number">3.4.3.1</span> Trace Plots</h4>
<p>The <code>bayesplot</code> package provides the function <code>mcmc_trace</code> which plots the Markov Chain Monte Carlo (MCMC) draws.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="rstanarm.html#cb6-1"></a><span class="kw">mcmc_trace</span>(mdl1, <span class="dt">pars=</span><span class="kw">c</span>(<span class="st">&quot;disp&quot;</span>, <span class="st">&quot;sigma&quot;</span>))</span></code></pre></div>
<p><img src="02_rstanarm_files/figure-html/mdl1_trace-1.png" width="672" /></p>
<p>There are three things I am looking for in the trace plot of each chain:</p>
<ol style="list-style-type: decimal">
<li><p><em>Good mixing</em> - In other words, the chain is rapidly changing values across the full region versus getting “stuck” near a particular value and slowly changing.</p></li>
<li><p><em>Stationarity</em> - The mean of the chain is relatively stable.</p></li>
<li><p><em>Convergence</em> - All of the chains spend most of the time around the same high-probability value.</p></li>
</ol>
<p>The trace plots above look good.</p>
</div>
<div id="trace-rank-plots" class="section level4">
<h4><span class="header-section-number">3.4.3.2</span> Trace Rank Plots</h4>
<p>It can sometimes be hard to interpret the trace plots when there are many chains. An alternative is the <code>mcmc_rank_overlay</code> function. This function plots a trace rank plot which is the distribution of the ranked samples; if the four chains have a roughly uniform distribution that indicates good mixing.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="rstanarm.html#cb7-1"></a><span class="kw">mcmc_rank_overlay</span>(mdl1, <span class="dt">pars=</span><span class="kw">c</span>(<span class="st">&quot;disp&quot;</span>, <span class="st">&quot;sigma&quot;</span>))</span></code></pre></div>
<p><img src="02_rstanarm_files/figure-html/mdl1_trank_plot-1.png" width="672" /></p>
</div>
<div id="widehatr-and-effective-sample-size" class="section level4">
<h4><span class="header-section-number">3.4.3.3</span> <span class="math inline">\(\widehat{R}\)</span> and Effective Sample Size</h4>
<p>In addition to visually examining the chains, we should also check <span class="math inline">\(\widehat{R}\)</span> which is a measure of convergence. <span class="math inline">\(\widehat{R} &gt; 1.0\)</span> indicates poor mixing, and the <code>mc_stan</code> documentation recommends only using samples if <span class="math inline">\(\widehat{R} &lt; 1.05\)</span>. However, a recent paper by <span class="citation">Vehtari et al. (<a href="#ref-Vehtari_2020" role="doc-biblioref">2020</a>)</span> recommends <span class="math inline">\(\widehat{R} &lt; 1.01\)</span>.</p>
<p>Since MCMC samples are usually correlated, the effective sample size (<code>n_eff</code>) is often less than the number of samples. There is no hard and fast rule for what is an acceptable number for <code>n_eff</code>. McElreath’s guidance is it depends on what you are trying to estimate. If you are interested mostly in the posterior mean, then <code>n_eff</code> = 200 can be enough. But if you are interested in the tails of the distribution and it’s highly skewed then you’ll need <code>n_eff</code> to be much larger. There are two parameters, <code>iter</code> and <code>warmup</code>, which you can adjust in <code>stan_glm</code> if a larger <code>n_eff</code> is needed.</p>
<p>The <code>summary</code> function displays <code>n_eff</code> and <span class="math inline">\(\widehat{R}\)</span> for the object returned by <code>stan_glm</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="rstanarm.html#cb8-1"></a><span class="kw">summary</span>(mdl1)</span></code></pre></div>
<pre><code>## 
## Model Info:
##  function:     stan_glm
##  family:       gaussian [identity]
##  formula:      mpg ~ disp
##  algorithm:    sampling
##  sample:       4000 (posterior sample size)
##  priors:       see help(&#39;prior_summary&#39;)
##  observations: 32
##  predictors:   2
## 
## Estimates:
##               mean   sd   10%   50%   90%
## (Intercept) 29.6    1.3 27.9  29.6  31.2 
## disp         0.0    0.0  0.0   0.0   0.0 
## sigma        3.4    0.5  2.8   3.3   4.0 
## 
## Fit Diagnostics:
##            mean   sd   10%   50%   90%
## mean_PPD 20.1    0.9 19.0  20.1  21.2 
## 
## The mean_ppd is the sample average posterior predictive distribution of the outcome variable (for details see help(&#39;summary.stanreg&#39;)).
## 
## MCMC diagnostics
##               mcse Rhat n_eff
## (Intercept)   0.0  1.0  3501 
## disp          0.0  1.0  3328 
## sigma         0.0  1.0  3056 
## mean_PPD      0.0  1.0  3411 
## log-posterior 0.0  1.0  1529 
## 
## For each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).</code></pre>
</div>
</div>
<div id="posterior-distribution" class="section level3">
<h3><span class="header-section-number">3.4.4</span> Posterior Distribution</h3>
<p>Since the chains, <code>n_eff</code> and <span class="math inline">\(\widehat{R}\)</span> look good, let’s examine the posterior distributions next.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="rstanarm.html#cb10-1"></a><span class="co"># Posterior point estimates (medians are used for point estimates)</span></span>
<span id="cb10-2"><a href="rstanarm.html#cb10-2"></a><span class="kw">coef</span>(mdl1)</span></code></pre></div>
<pre><code>## (Intercept)        disp 
##    29.57206    -0.04103</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="rstanarm.html#cb12-1"></a><span class="co"># 95% credible intervals</span></span>
<span id="cb12-2"><a href="rstanarm.html#cb12-2"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">posterior_interval</span>(mdl1, <span class="dt">prob=</span><span class="fl">0.95</span>))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
2.5%
</th>
<th style="text-align:right;">
97.5%
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
27.0319
</td>
<td style="text-align:right;">
32.1255
</td>
</tr>
<tr>
<td style="text-align:left;">
disp
</td>
<td style="text-align:right;">
-0.0509
</td>
<td style="text-align:right;">
-0.0313
</td>
</tr>
<tr>
<td style="text-align:left;">
sigma
</td>
<td style="text-align:right;">
2.6281
</td>
<td style="text-align:right;">
4.3876
</td>
</tr>
</tbody>
</table>
</div>
<div id="posterior-predictive-distribution" class="section level3">
<h3><span class="header-section-number">3.4.5</span> Posterior Predictive Distribution</h3>
<p>The <code>posterior_predict</code> function draws samples from the posterior predictive distribution. The <code>shinystan</code> package also generates nice plots of the posterior predictive distribution.</p>
<p>In this case, I’m going to plot the expected value of the posterior predictive distribution and overlay the observations since I think it can be easier to understand for someone new to these methods. The <code>posterior_linpred</code> function returns the linear predictor, possibly transformed by the inverse-link function. The <code>posterior_epred</code> function returns the expectation over the posterior predictive distribution. In this example, the model is a Gaussian likelihood with an identity link function, so the two functions return identical results.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="rstanarm.html#cb13-1"></a>newdata &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">disp=</span><span class="kw">seq</span>(<span class="kw">min</span>(mtcars<span class="op">$</span>disp), <span class="kw">max</span>(mtcars<span class="op">$</span>disp)))</span>
<span id="cb13-2"><a href="rstanarm.html#cb13-2"></a></span>
<span id="cb13-3"><a href="rstanarm.html#cb13-3"></a>y_rep &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">t</span>(<span class="kw">posterior_epred</span>(mdl1, <span class="dt">newdata=</span>newdata, <span class="dt">draws=</span><span class="dv">50</span>))) <span class="op">%&gt;%</span></span>
<span id="cb13-4"><a href="rstanarm.html#cb13-4"></a><span class="st">  </span><span class="kw">cbind</span>(newdata) <span class="op">%&gt;%</span></span>
<span id="cb13-5"><a href="rstanarm.html#cb13-5"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols=</span><span class="kw">starts_with</span>(<span class="st">&quot;V&quot;</span>), <span class="dt">names_to=</span><span class="st">&quot;grp&quot;</span>, <span class="dt">values_to=</span><span class="st">&quot;mpg&quot;</span>)</span>
<span id="cb13-6"><a href="rstanarm.html#cb13-6"></a></span>
<span id="cb13-7"><a href="rstanarm.html#cb13-7"></a>y_rep <span class="op">%&gt;%</span></span>
<span id="cb13-8"><a href="rstanarm.html#cb13-8"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>disp, <span class="dt">y=</span>mpg)) <span class="op">+</span></span>
<span id="cb13-9"><a href="rstanarm.html#cb13-9"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group=</span>grp), <span class="dt">alpha=</span><span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb13-10"><a href="rstanarm.html#cb13-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mtcars) </span></code></pre></div>
<p><img src="02_rstanarm_files/figure-html/mdl1_ppd-1.png" width="672" /></p>
</div>
</div>
<div id="linear-model-user-defined-priors" class="section level2">
<h2><span class="header-section-number">3.5</span> Linear Model (User-Defined Priors)</h2>
<p>Now I’ll specify priors which incorporate my prior knowledge that <code>mpg</code> is non-negative and is non-increasing as <code>disp</code> increases. My new model is as follows:</p>
<p><span class="math display">\[\begin{align*}
  mpg &amp;\sim N(\mu, \sigma^2) \\
  \mu &amp;= a + b*disp \\
  a &amp;\sim Normal(25,10^2) \\
  b &amp;\sim Normal(-0.2, 0.1^2) \\
  \sigma &amp;\sim Exponential(1)
\end{align*}\]</span></p>
<p>The differences from the default priors are</p>
<ol style="list-style-type: decimal">
<li><p>The intercept prior has a slightly smaller variance so negative values of<code>mpg</code> are less likely.</p></li>
<li><p>The slope prior is no longer symmetric about 0, but rather it is centered at -0.2 so that positive values are less likely.</p></li>
</ol>
<div id="define-model-1" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Define Model</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="rstanarm.html#cb14-1"></a>mdl2 &lt;-<span class="st"> </span><span class="kw">stan_glm</span>(mpg <span class="op">~</span><span class="st"> </span>disp, <span class="dt">data =</span> mtcars,</span>
<span id="cb14-2"><a href="rstanarm.html#cb14-2"></a>                 <span class="dt">prior =</span> <span class="kw">normal</span>(<span class="op">-</span><span class="fl">0.2</span>, <span class="fl">0.1</span>), <span class="co"># prior for slope</span></span>
<span id="cb14-3"><a href="rstanarm.html#cb14-3"></a>                 <span class="dt">prior_intercept =</span> <span class="kw">normal</span>(<span class="dv">25</span>,<span class="dv">10</span>), <span class="co"># prior for intercept</span></span>
<span id="cb14-4"><a href="rstanarm.html#cb14-4"></a>                 <span class="dt">prior_aux =</span> <span class="kw">exponential</span>(<span class="dv">1</span>))  <span class="co"># prior for standard deviation</span></span></code></pre></div>
</div>
<div id="prior-predictive-distribution-1" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Prior Predictive Distribution</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="rstanarm.html#cb15-1"></a>cdisp &lt;-<span class="st"> </span>mtcars<span class="op">$</span>disp <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(mtcars<span class="op">$</span>disp)</span>
<span id="cb15-2"><a href="rstanarm.html#cb15-2"></a>tmp &lt;-<span class="st"> </span><span class="kw">stan_glm</span>(mpg <span class="op">~</span><span class="st"> </span>cdisp, <span class="dt">data =</span> mtcars,</span>
<span id="cb15-3"><a href="rstanarm.html#cb15-3"></a>                 <span class="dt">prior =</span> <span class="kw">normal</span>(<span class="op">-</span><span class="fl">0.2</span>, <span class="fl">0.1</span>), <span class="co"># prior for slope</span></span>
<span id="cb15-4"><a href="rstanarm.html#cb15-4"></a>                 <span class="dt">prior_intercept =</span> <span class="kw">normal</span>(<span class="dv">20</span>,<span class="dv">15</span>), <span class="co"># prior for intercept</span></span>
<span id="cb15-5"><a href="rstanarm.html#cb15-5"></a>                 <span class="dt">prior_aux =</span> <span class="kw">exponential</span>(<span class="dv">1</span>),  <span class="co"># prior for standard deviation</span></span>
<span id="cb15-6"><a href="rstanarm.html#cb15-6"></a>                  <span class="dt">prior_PD =</span> <span class="ot">TRUE</span>, <span class="dt">chains=</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## 
## SAMPLING FOR MODEL &#39;continuous&#39; NOW (CHAIN 1).
## Chain 1: 
## Chain 1: Gradient evaluation took 7.5e-05 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.75 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
## Chain 1: 
## Chain 1:  Elapsed Time: 0.036544 seconds (Warm-up)
## Chain 1:                0.04268 seconds (Sampling)
## Chain 1:                0.079224 seconds (Total)
## Chain 1:</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="rstanarm.html#cb17-1"></a><span class="kw">prior_summary</span>(tmp)</span></code></pre></div>
<pre><code>## Priors for model &#39;tmp&#39; 
## ------
## Intercept (after predictors centered)
##  ~ normal(location = 20, scale = 15)
## 
## Coefficients
##  ~ normal(location = -0.2, scale = 0.1)
## 
## Auxiliary (sigma)
##  ~ exponential(rate = 1)
## ------
## See help(&#39;prior_summary.stanreg&#39;) for more details</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="rstanarm.html#cb19-1"></a>draws &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(tmp) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">100</span>)</span>
<span id="cb19-2"><a href="rstanarm.html#cb19-2"></a><span class="kw">colMeans</span>(draws)</span></code></pre></div>
<pre><code>## (Intercept)       cdisp       sigma 
##     21.3987     -0.1943      0.9352</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="rstanarm.html#cb21-1"></a>y &lt;-<span class="st"> </span><span class="kw">apply</span>(draws, <span class="dv">1</span>, <span class="cf">function</span>(x) x[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>x[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>(D <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(mtcars<span class="op">$</span>disp))) <span class="op">%&gt;%</span></span>
<span id="cb21-2"><a href="rstanarm.html#cb21-2"></a><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></span>
<span id="cb21-3"><a href="rstanarm.html#cb21-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">disp=</span>D) <span class="op">%&gt;%</span></span>
<span id="cb21-4"><a href="rstanarm.html#cb21-4"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>disp, <span class="dt">names_to=</span><span class="st">&quot;iter&quot;</span>, <span class="dt">values_to=</span><span class="st">&quot;mpg&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="rstanarm.html#cb23-1"></a>y <span class="op">%&gt;%</span></span>
<span id="cb23-2"><a href="rstanarm.html#cb23-2"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb23-3"><a href="rstanarm.html#cb23-3"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>disp, <span class="dt">y=</span>mpg, <span class="dt">group=</span>iter), <span class="dt">alpha=</span><span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="02_rstanarm_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="rstanarm.html#cb24-1"></a><span class="co"># Plot prior predictive distribution using adjusted priors</span></span>
<span id="cb24-2"><a href="rstanarm.html#cb24-2"></a>N &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb24-3"><a href="rstanarm.html#cb24-3"></a></span>
<span id="cb24-4"><a href="rstanarm.html#cb24-4"></a>prior_samples &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">a =</span> <span class="kw">rnorm</span>(N, <span class="dv">20</span>, <span class="dv">15</span>),</span>
<span id="cb24-5"><a href="rstanarm.html#cb24-5"></a>                            <span class="dt">b =</span> <span class="kw">rnorm</span>(N, <span class="fl">-0.2</span>, <span class="fl">0.1</span>))</span>
<span id="cb24-6"><a href="rstanarm.html#cb24-6"></a></span>
<span id="cb24-7"><a href="rstanarm.html#cb24-7"></a>D &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(mtcars<span class="op">$</span>disp), <span class="kw">max</span>(mtcars<span class="op">$</span>disp), <span class="dt">length.out =</span> N)</span>
<span id="cb24-8"><a href="rstanarm.html#cb24-8"></a></span>
<span id="cb24-9"><a href="rstanarm.html#cb24-9"></a>res &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">apply</span>(prior_samples, <span class="dv">1</span>, </span>
<span id="cb24-10"><a href="rstanarm.html#cb24-10"></a>                           <span class="cf">function</span>(x) x[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>x[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>(D<span class="op">-</span><span class="kw">mean</span>(mtcars<span class="op">$</span>disp)))) <span class="op">%&gt;%</span></span>
<span id="cb24-11"><a href="rstanarm.html#cb24-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">disp =</span> D) <span class="op">%&gt;%</span></span>
<span id="cb24-12"><a href="rstanarm.html#cb24-12"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols=</span><span class="kw">c</span>(<span class="op">-</span><span class="st">&quot;disp&quot;</span>), <span class="dt">names_to=</span><span class="st">&quot;iter&quot;</span>) </span>
<span id="cb24-13"><a href="rstanarm.html#cb24-13"></a></span>
<span id="cb24-14"><a href="rstanarm.html#cb24-14"></a>res <span class="op">%&gt;%</span></span>
<span id="cb24-15"><a href="rstanarm.html#cb24-15"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb24-16"><a href="rstanarm.html#cb24-16"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>disp, <span class="dt">y=</span>value, <span class="dt">group=</span>iter), <span class="dt">alpha=</span><span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb24-17"><a href="rstanarm.html#cb24-17"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;disp&quot;</span>, <span class="dt">y=</span><span class="st">&quot;prior predictive mpg&quot;</span>)</span></code></pre></div>
<p><img src="02_rstanarm_files/figure-html/mdl2_prior_plot-1.png" width="672" /></p>
<p>Compared to the prior predictive distribution with the default priors, this looks more consistent with my real-world knowledge that was reflected in the priors.</p>
</div>
<div id="diagnostics-1" class="section level3">
<h3><span class="header-section-number">3.5.3</span> Diagnostics</h3>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="rstanarm.html#cb25-1"></a><span class="kw">mcmc_trace</span>(mdl2, <span class="dt">pars=</span><span class="kw">c</span>(<span class="st">&quot;disp&quot;</span>, <span class="st">&quot;sigma&quot;</span>))</span></code></pre></div>
<p><img src="02_rstanarm_files/figure-html/mdl2_trace-1.png" width="672" /></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="rstanarm.html#cb26-1"></a><span class="kw">summary</span>(mdl2)</span></code></pre></div>
<pre><code>## 
## Model Info:
##  function:     stan_glm
##  family:       gaussian [identity]
##  formula:      mpg ~ disp
##  algorithm:    sampling
##  sample:       4000 (posterior sample size)
##  priors:       see help(&#39;prior_summary&#39;)
##  observations: 32
##  predictors:   2
## 
## Estimates:
##               mean   sd   10%   50%   90%
## (Intercept) 29.7    1.3 28.1  29.7  31.3 
## disp         0.0    0.0  0.0   0.0   0.0 
## sigma        3.2    0.4  2.7   3.2   3.7 
## 
## Fit Diagnostics:
##            mean   sd   10%   50%   90%
## mean_PPD 20.1    0.8 19.1  20.1  21.2 
## 
## The mean_ppd is the sample average posterior predictive distribution of the outcome variable (for details see help(&#39;summary.stanreg&#39;)).
## 
## MCMC diagnostics
##               mcse Rhat n_eff
## (Intercept)   0.0  1.0  2856 
## disp          0.0  1.0  2791 
## sigma         0.0  1.0  2921 
## mean_PPD      0.0  1.0  3370 
## log-posterior 0.0  1.0  1656 
## 
## For each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).</code></pre>
<p>The trace plots, <code>n_eff</code> and <span class="math inline">\(\widehat{R}\)</span> all look good.</p>
</div>
<div id="posterior-distribution-1" class="section level3">
<h3><span class="header-section-number">3.5.4</span> Posterior Distribution</h3>
<p>Now let’s compare the posterior with informative versus default priors:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="rstanarm.html#cb28-1"></a><span class="co"># Point estimates</span></span>
<span id="cb28-2"><a href="rstanarm.html#cb28-2"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">cbind</span>(<span class="kw">coef</span>(mdl1), <span class="kw">coef</span>(mdl2)), <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Default&quot;</span>, <span class="st">&quot;Informative&quot;</span>))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Default
</th>
<th style="text-align:right;">
Informative
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
29.572
</td>
<td style="text-align:right;">
29.6912
</td>
</tr>
<tr>
<td style="text-align:left;">
disp
</td>
<td style="text-align:right;">
-0.041
</td>
<td style="text-align:right;">
-0.0415
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="rstanarm.html#cb29-1"></a><span class="co"># 95% credible intervals</span></span>
<span id="cb29-2"><a href="rstanarm.html#cb29-2"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">cbind</span>(<span class="kw">posterior_interval</span>(mdl1, <span class="dt">prob=</span><span class="fl">0.95</span>),</span>
<span id="cb29-3"><a href="rstanarm.html#cb29-3"></a>                  <span class="kw">posterior_interval</span>(mdl2, <span class="dt">prob=</span><span class="fl">0.95</span>))) <span class="op">%&gt;%</span></span>
<span id="cb29-4"><a href="rstanarm.html#cb29-4"></a><span class="st">  </span><span class="kw">add_header_above</span>(<span class="kw">c</span>(<span class="st">&quot; &quot;</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;Default&quot;</span> =<span class="st"> </span><span class="dv">2</span>, <span class="st">&quot;Informative&quot;</span> =<span class="st"> </span><span class="dv">2</span>))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Default
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Informative
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
2.5%
</th>
<th style="text-align:right;">
97.5%
</th>
<th style="text-align:right;">
2.5%
</th>
<th style="text-align:right;">
97.5%
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
27.0319
</td>
<td style="text-align:right;">
32.1255
</td>
<td style="text-align:right;">
27.180
</td>
<td style="text-align:right;">
32.1083
</td>
</tr>
<tr>
<td style="text-align:left;">
disp
</td>
<td style="text-align:right;">
-0.0509
</td>
<td style="text-align:right;">
-0.0313
</td>
<td style="text-align:right;">
-0.051
</td>
<td style="text-align:right;">
-0.0322
</td>
</tr>
<tr>
<td style="text-align:left;">
sigma
</td>
<td style="text-align:right;">
2.6281
</td>
<td style="text-align:right;">
4.3876
</td>
<td style="text-align:right;">
2.531
</td>
<td style="text-align:right;">
4.1268
</td>
</tr>
</tbody>
</table>
<p>In this case, there is sufficient data that the choice of prior really didn’t make much of a difference.</p>
</div>
<div id="posterior-predictive-distribution-1" class="section level3">
<h3><span class="header-section-number">3.5.5</span> Posterior Predictive Distribution</h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="rstanarm.html#cb30-1"></a>newdata &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">disp=</span><span class="kw">seq</span>(<span class="kw">min</span>(mtcars<span class="op">$</span>disp), <span class="kw">max</span>(mtcars<span class="op">$</span>disp)))</span>
<span id="cb30-2"><a href="rstanarm.html#cb30-2"></a></span>
<span id="cb30-3"><a href="rstanarm.html#cb30-3"></a>y_rep &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">t</span>(<span class="kw">posterior_epred</span>(mdl2, <span class="dt">newdata=</span>newdata, <span class="dt">draws=</span><span class="dv">50</span>))) <span class="op">%&gt;%</span></span>
<span id="cb30-4"><a href="rstanarm.html#cb30-4"></a><span class="st">  </span><span class="kw">cbind</span>(newdata) <span class="op">%&gt;%</span></span>
<span id="cb30-5"><a href="rstanarm.html#cb30-5"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols=</span><span class="kw">starts_with</span>(<span class="st">&quot;V&quot;</span>), <span class="dt">names_to=</span><span class="st">&quot;grp&quot;</span>, <span class="dt">values_to=</span><span class="st">&quot;mpg&quot;</span>)</span>
<span id="cb30-6"><a href="rstanarm.html#cb30-6"></a></span>
<span id="cb30-7"><a href="rstanarm.html#cb30-7"></a>y_rep <span class="op">%&gt;%</span></span>
<span id="cb30-8"><a href="rstanarm.html#cb30-8"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>disp, <span class="dt">y=</span>mpg)) <span class="op">+</span></span>
<span id="cb30-9"><a href="rstanarm.html#cb30-9"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group=</span>grp), <span class="dt">alpha=</span><span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb30-10"><a href="rstanarm.html#cb30-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mtcars) </span></code></pre></div>
<p><img src="02_rstanarm_files/figure-html/mdl2_ppd-1.png" width="672" /></p>
</div>
</div>
<div id="semi-parametric-model" class="section level2">
<h2><span class="header-section-number">3.6</span> Semi-parametric Model</h2>
<div id="define-model-2" class="section level3">
<h3><span class="header-section-number">3.6.1</span> Define model</h3>
<p>The linear model is a poor choice for this data, so I’ll try a model with splines next. The <code>stan_gamm4</code> function from the <code>rstanarm</code> package fits Bayesian nonlinear (and mixed) models.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="rstanarm.html#cb31-1"></a>mdl3 &lt;-<span class="st"> </span><span class="kw">stan_gamm4</span>(mpg <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(disp, <span class="dt">bs=</span><span class="st">&quot;cr&quot;</span>, <span class="dt">k=</span><span class="dv">7</span>), </span>
<span id="cb31-2"><a href="rstanarm.html#cb31-2"></a>                   <span class="dt">data =</span> mtcars, </span>
<span id="cb31-3"><a href="rstanarm.html#cb31-3"></a>                   <span class="dt">adapt_delta =</span> <span class="fl">0.99</span>)</span></code></pre></div>
</div>
<div id="prior-predictive-distribution-2" class="section level3">
<h3><span class="header-section-number">3.6.2</span> Prior Predictive Distribution</h3>
<p>Unlike the linear model, it’s not as straightforward to manually construct the prior predictive distribution. Fortunately, <code>rstanarm</code> can automatically generate the prior predictive distribution too–we just refit the model <em>without</em> conditioning on the data by setting <code>prior_PD = TRUE</code>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="rstanarm.html#cb32-1"></a>mdl3_prior_pred &lt;-<span class="st"> </span><span class="kw">stan_gamm4</span>(mpg <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(disp, <span class="dt">bs=</span><span class="st">&quot;cr&quot;</span>, <span class="dt">k=</span><span class="dv">7</span>), </span>
<span id="cb32-2"><a href="rstanarm.html#cb32-2"></a>                   <span class="dt">data =</span> mtcars, </span>
<span id="cb32-3"><a href="rstanarm.html#cb32-3"></a>                   <span class="dt">prior_PD =</span> <span class="ot">TRUE</span>,</span>
<span id="cb32-4"><a href="rstanarm.html#cb32-4"></a>                   <span class="dt">adapt_delta =</span> <span class="fl">0.99</span>)</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="rstanarm.html#cb33-1"></a>N &lt;-<span class="st"> </span><span class="dv">50</span></span>
<span id="cb33-2"><a href="rstanarm.html#cb33-2"></a></span>
<span id="cb33-3"><a href="rstanarm.html#cb33-3"></a>D &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(mtcars<span class="op">$</span>disp), <span class="kw">max</span>(mtcars<span class="op">$</span>disp), <span class="dt">length.out =</span> N)</span>
<span id="cb33-4"><a href="rstanarm.html#cb33-4"></a></span>
<span id="cb33-5"><a href="rstanarm.html#cb33-5"></a>prior_pred &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(<span class="kw">posterior_epred</span>(mdl3_prior_pred,</span>
<span id="cb33-6"><a href="rstanarm.html#cb33-6"></a>                                <span class="dt">newdata=</span><span class="kw">data.frame</span>(<span class="dt">disp=</span>D),</span>
<span id="cb33-7"><a href="rstanarm.html#cb33-7"></a>                                <span class="dt">draws=</span>N)))</span>
<span id="cb33-8"><a href="rstanarm.html#cb33-8"></a></span>
<span id="cb33-9"><a href="rstanarm.html#cb33-9"></a>tmp &lt;-<span class="st"> </span>prior_pred <span class="op">%&gt;%</span></span>
<span id="cb33-10"><a href="rstanarm.html#cb33-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">disp =</span> D)<span class="op">%&gt;%</span></span>
<span id="cb33-11"><a href="rstanarm.html#cb33-11"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols=</span><span class="op">-</span><span class="st">&quot;disp&quot;</span>, <span class="dt">names_to=</span><span class="st">&quot;iter&quot;</span>, <span class="dt">values_to=</span><span class="st">&quot;mpg&quot;</span>) </span>
<span id="cb33-12"><a href="rstanarm.html#cb33-12"></a></span>
<span id="cb33-13"><a href="rstanarm.html#cb33-13"></a>tmp <span class="op">%&gt;%</span></span>
<span id="cb33-14"><a href="rstanarm.html#cb33-14"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb33-15"><a href="rstanarm.html#cb33-15"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>disp, <span class="dt">y=</span>mpg, <span class="dt">group=</span>iter), <span class="dt">alpha=</span><span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb33-16"><a href="rstanarm.html#cb33-16"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>mtcars, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>disp, <span class="dt">y=</span>mpg), <span class="dt">color=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="02_rstanarm_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>This prior predictive distribution gives us some crazy possibilities. However we saw earlier that there is enough data that the model isn’t very sensitive to the choice of prior, so let’s continue and see what happens.</p>
</div>
<div id="diagnostics-and-posterior" class="section level3">
<h3><span class="header-section-number">3.6.3</span> Diagnostics and Posterior</h3>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="rstanarm.html#cb34-1"></a><span class="kw">mcmc_trace</span>(mdl3, <span class="dt">regex_pars=</span><span class="kw">c</span>(<span class="st">&quot;disp&quot;</span>, <span class="st">&quot;sigma&quot;</span>))</span></code></pre></div>
<p><img src="02_rstanarm_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="rstanarm.html#cb35-1"></a><span class="kw">summary</span>(mdl3)</span></code></pre></div>
<pre><code>## 
## Model Info:
##  function:     stan_gamm4
##  family:       gaussian [identity]
##  formula:      mpg ~ s(disp, bs = &quot;cr&quot;, k = 7)
##  algorithm:    sampling
##  sample:       4000 (posterior sample size)
##  priors:       see help(&#39;prior_summary&#39;)
##  observations: 32
## 
## Estimates:
##                       mean   sd   10%   50%   90%
## (Intercept)         20.1    0.4 19.5  20.1  20.6 
## s(disp).1            0.2    1.3 -1.2   0.2   1.6 
## s(disp).2           -0.9    1.1 -2.3  -0.8   0.3 
## s(disp).3            0.0    0.6 -0.7   0.0   0.7 
## s(disp).4            1.2    0.4  0.7   1.2   1.6 
## s(disp).5            0.4    0.1  0.2   0.4   0.6 
## s(disp).6           -3.1    0.3 -3.5  -3.1  -2.8 
## sigma                2.4    0.3  2.0   2.4   2.9 
## smooth_sd[s(disp)1]  1.2    0.7  0.5   1.0   2.1 
## smooth_sd[s(disp)2]  3.5    2.0  1.7   3.0   6.0 
## 
## Fit Diagnostics:
##            mean   sd   10%   50%   90%
## mean_PPD 20.1    0.6 19.3  20.1  20.9 
## 
## The mean_ppd is the sample average posterior predictive distribution of the outcome variable (for details see help(&#39;summary.stanreg&#39;)).
## 
## MCMC diagnostics
##                     mcse Rhat n_eff
## (Intercept)         0.0  1.0  3357 
## s(disp).1           0.0  1.0  3086 
## s(disp).2           0.0  1.0  2252 
## s(disp).3           0.0  1.0  4115 
## s(disp).4           0.0  1.0  2455 
## s(disp).5           0.0  1.0  4283 
## s(disp).6           0.0  1.0  3509 
## sigma               0.0  1.0  2720 
## smooth_sd[s(disp)1] 0.0  1.0  1229 
## smooth_sd[s(disp)2] 0.0  1.0  2250 
## mean_PPD            0.0  1.0  3322 
## log-posterior       0.1  1.0   842 
## 
## For each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).</code></pre>
<p>The chains, <code>n_eff</code> and <span class="math inline">\(\widehat{R}\)</span> look good. In the Estimates section above, we also see the posteriors for the model parameters; there isn’t an intuitive interpretation of the spline coefficients so I’ll skip ahead to the posterior predictive distribution.</p>
</div>
<div id="posterior-predictive-distribution-2" class="section level3">
<h3><span class="header-section-number">3.6.4</span> Posterior Predictive Distribution</h3>
<p>The expectation over the ppd is plotted below, along with a loess curve for comparison. This model is clearly a better fit to the data than the linear model.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="rstanarm.html#cb37-1"></a><span class="kw">plot_nonlinear</span>(mdl3, <span class="dt">prob=</span><span class="fl">0.95</span>) <span class="op">+</span></span>
<span id="cb37-2"><a href="rstanarm.html#cb37-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>disp, <span class="dt">y=</span>mpg<span class="op">-</span><span class="kw">mean</span>(mpg)),</span>
<span id="cb37-3"><a href="rstanarm.html#cb37-3"></a>             <span class="dt">data=</span>mtcars) <span class="op">+</span></span>
<span id="cb37-4"><a href="rstanarm.html#cb37-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;GAM&quot;</span>, <span class="dt">x=</span><span class="st">&quot;disp&quot;</span>, <span class="dt">y=</span><span class="st">&quot;mpg-mean(mpg)&quot;</span>)</span>
<span id="cb37-5"><a href="rstanarm.html#cb37-5"></a></span>
<span id="cb37-6"><a href="rstanarm.html#cb37-6"></a><span class="kw">ggplot</span>(<span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>disp, <span class="dt">y=</span>mpg<span class="op">-</span><span class="kw">mean</span>(mpg)),</span>
<span id="cb37-7"><a href="rstanarm.html#cb37-7"></a>              <span class="dt">data=</span>mtcars) <span class="op">+</span></span>
<span id="cb37-8"><a href="rstanarm.html#cb37-8"></a><span class="st">  </span><span class="kw">geom_point</span>()<span class="op">+</span></span>
<span id="cb37-9"><a href="rstanarm.html#cb37-9"></a><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method=</span><span class="st">&quot;loess&quot;</span>,</span>
<span id="cb37-10"><a href="rstanarm.html#cb37-10"></a>              <span class="dt">level=</span><span class="fl">0.95</span>) <span class="op">+</span></span>
<span id="cb37-11"><a href="rstanarm.html#cb37-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;LOESS&quot;</span>)</span></code></pre></div>
<p><img src="02_rstanarm_files/figure-html/mdl3_ppd,%20figures-side-1.png" width="50%" /><img src="02_rstanarm_files/figure-html/mdl3_ppd,%20figures-side-2.png" width="50%" /></p>
</div>
</div>
<div id="session-info" class="section level2">
<h2><span class="header-section-number">3.7</span> Session Info</h2>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="rstanarm.html#cb38-1"></a><span class="kw">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.0.3 (2020-10-10)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices datasets  utils     methods   base     
## 
## other attached packages:
##  [1] bayesplot_1.7.2  rstanarm_2.21.1  Rcpp_1.0.5       kableExtra_1.3.1
##  [5] gridExtra_2.3    forcats_0.5.0    stringr_1.4.0    dplyr_1.0.2     
##  [9] purrr_0.3.4      readr_1.4.0      tidyr_1.1.2      tibble_3.0.4    
## [13] ggplot2_3.3.2    tidyverse_1.3.0 
## 
## loaded via a namespace (and not attached):
##   [1] minqa_1.2.4          colorspace_2.0-0     ellipsis_0.3.1      
##   [4] ggridges_0.5.2       rsconnect_0.8.16     markdown_1.1        
##   [7] base64enc_0.1-3      fs_1.5.0             rstudioapi_0.13     
##  [10] farver_2.0.3         rstan_2.21.2         DT_0.16             
##  [13] fansi_0.4.1          lubridate_1.7.9.2    xml2_1.3.2          
##  [16] splines_4.0.3        codetools_0.2-16     knitr_1.30          
##  [19] shinythemes_1.1.2    jsonlite_1.7.1       nloptr_1.2.2.2      
##  [22] broom_0.7.2          dbplyr_2.0.0         shiny_1.5.0         
##  [25] compiler_4.0.3       httr_1.4.2           backports_1.2.0     
##  [28] Matrix_1.2-18        assertthat_0.2.1     fastmap_1.0.1       
##  [31] cli_2.2.0            later_1.1.0.1        htmltools_0.5.0     
##  [34] prettyunits_1.1.1    tools_4.0.3          igraph_1.2.6        
##  [37] gtable_0.3.0         glue_1.4.2           reshape2_1.4.4      
##  [40] V8_3.4.0             cellranger_1.1.0     vctrs_0.3.5         
##  [43] nlme_3.1-149         crosstalk_1.1.0.1    xfun_0.19           
##  [46] ps_1.4.0             lme4_1.1-26          rvest_0.3.6         
##  [49] mime_0.9             miniUI_0.1.1.1       lifecycle_0.2.0     
##  [52] renv_0.12.0          gtools_3.8.2         statmod_1.4.35      
##  [55] MASS_7.3-53          zoo_1.8-8            scales_1.1.1        
##  [58] colourpicker_1.1.0   hms_0.5.3            promises_1.1.1      
##  [61] parallel_4.0.3       inline_0.3.17        shinystan_2.5.0     
##  [64] yaml_2.2.1           curl_4.3             loo_2.3.1           
##  [67] StanHeaders_2.21.0-6 stringi_1.5.3        highr_0.8           
##  [70] dygraphs_1.1.1.6     boot_1.3-25          pkgbuild_1.1.0      
##  [73] rlang_0.4.9          pkgconfig_2.0.3      matrixStats_0.57.0  
##  [76] evaluate_0.14        lattice_0.20-41      labeling_0.4.2      
##  [79] rstantools_2.1.1     htmlwidgets_1.5.2    tidyselect_1.1.0    
##  [82] processx_3.4.5       plyr_1.8.6           magrittr_2.0.1      
##  [85] bookdown_0.21        R6_2.5.0             generics_0.1.0      
##  [88] DBI_1.1.0            mgcv_1.8-33          pillar_1.4.7        
##  [91] haven_2.3.1          withr_2.3.0          xts_0.12.1          
##  [94] survival_3.2-7       modelr_0.1.8         crayon_1.3.4        
##  [97] rmarkdown_2.5        grid_4.0.3           readxl_1.3.1        
## [100] callr_3.5.1          threejs_0.3.3        reprex_0.3.0        
## [103] digest_0.6.27        webshot_0.5.2        xtable_1.8-4        
## [106] httpuv_1.5.4         RcppParallel_5.0.2   stats4_4.0.3        
## [109] munsell_0.5.0        viridisLite_0.3.0    shinyjs_2.0.0</code></pre>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Vehtari_2020">
<p>Vehtari, Aki, Andrew Gelman, Daniel Simpson, Bob Carpenter, and Paul-Christian Bürkner. 2020. “Rank-Normalization, Folding, and Localization: An Improved <span class="math inline">\(\widehat{R}\)</span> for Assessing Convergence of Mcmc.” <em>Bayesian Analysis</em>, July. <a href="https://doi.org/10.1214/20-ba1221">https://doi.org/10.1214/20-ba1221</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rethinking.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/02_rstanarm.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["r-ladies-rtp-bayes-pkgs.pdf", "r-ladies-rtp-bayes-pkgs.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
